% !TEX root = _main.tex
% ========================================
% 卒業論文　本文
% ========================================
\section{はじめに}


本研究では，楽曲の特徴量を数値的に抽出し，
その構造を分析することを目的とする。
本年度はバッハのコラールを対象とし，
特徴量分析およびクラスタリングによる構造把握を試みた。
研究動機としては、楽曲ごとの曲の違いをデータとして閲覧したかったというのと、
今後の研究にも応用できる研究であると考えたためである。

%2
\section{特徴量抽出}
楽曲の解析には Python を用い、
music21 ライブラリによって
以下の特徴量を抽出した。
% ================================
\input{table_features.tex}
% ================================
本研究では、MIDIデータから抽出可能な特徴量のうち、
音高、リズム、和声の三要素に基づく特徴量を使用した。

本年度の研究では、解釈可能性を重視し、
少数の代表的特徴量に限定して解析を行った。
%3
\section{分析手法}
\subsection{使用したデータセット}
使用したデータセットは、J.S.バッハのコラール曲集Infinitebach\cite{Infinitebach}である。このデータセットは、無料で入手できるため、本研究で使用した。
コラール（独: Choral、衆讃歌、衆賛歌）は、もともとルター派教会にて全会衆によって歌われるための賛美歌である。
現代では、これらの賛美歌の典型的な形式や、類似した性格をもつ作品をも含めて呼ぶことが多い。\cite{Koraru}


\subsection{分析環境とライブラリ}
本研究では、楽曲特徴量の抽出および解析に Python を用いた。
解析環境として、Python 3 系および以下の主要ライブラリを使用した。

\subsection{楽曲解析ライブラリ（music21）}

本研究における楽曲特徴量の抽出には、
Python 用音楽解析ライブラリ music21 を使用した。

music21 は、MIDI ファイルや楽譜データを対象として、
音高、リズム、和声などの構造的情報を解析可能なライブラリである。
本研究では、MIDI 形式で提供されている楽曲データを入力とし、
表\ref{tab:features}に示す特徴量を抽出した。
これらの特徴量は、演奏表現ではなく楽曲構造そのものを捉える
Symbolic 音楽解析に基づくものである。

\subsection{データ処理および前処理（pandas / numpy）}

抽出した特徴量は、
Python のデータ解析ライブラリ pandas および numpy を用いて
表形式データとして整理した。

各楽曲を1行、各特徴量を1列とするデータフレームを作成し、
欠損値の補完や数値処理を行った後、
後続の解析に利用可能な形式（CSV）として保存した。

\subsection{標準化処理（scikit-learn）}

異なるスケールを持つ特徴量を同時に扱うため、
機械学習ライブラリ scikit-learn を用いて標準化を行った。

本研究では、各特徴量を平均0、分散1となるように変換する
Z-score 正規化を適用した。
これにより、特定の特徴量が解析結果に過度に影響することを防いだ。

\subsection{主成分分析（PCA）}

高次元特徴量空間の構造を把握するため、
scikit-learn に実装されている 主成分分析（PCA） を用いた。

PCA は、特徴量間の相関を考慮しつつ分散を最大化する
直交軸（主成分）を求める手法であり、
本研究では、高次元特徴量の低次元可視化、特徴量構造の把握、クラスタ分離に寄与する主軸の確認のために使用した。

特に、第1主成分（PC1）および第2主成分（PC2）に着目し、
楽曲データの分布を散布図として可視化した。

\subsection{クラスタリング（K-means）}

楽曲特徴量に基づく分類を行うため、
scikit-learn に実装されている K-means クラスタリングを用いた。

K-means 法は、データ点間の距離に基づいて
あらかじめ指定した数のクラスタに分割する手法である。

本研究では、PCA によって得られた低次元空間および
標準化後の特徴量空間を用いてクラスタリングを行い、
楽曲の構造的な類似性を検討した。

\subsection{可視化（matplotlib）}

解析結果の可視化には、
Python の描画ライブラリ matplotlib を使用した。

主成分分析結果の散布図や、
クラスタリング結果の色分け表示を行うことで、
楽曲特徴量の分布およびクラスタ構造を直感的に把握した。

%4
\section{分析}

\input{table_chorale1}
\input{table_chorale2}
\input{table_chorale3}


\subsection{分析1回目}
まず、全楽曲を対象にクラスタリングを行った。
PCAによる散布図を\figref{fig:pca}に示す。



黄色で示した部分がクラスタ0、青色で示した部分がクラスタ1とする。
また、クラスタごとの特徴量平均の比較を\figref{fig:average1}に、クラスタごとのZ-score（平均からの相対距離）を\figref{fig:Z-score1}に示す。


\subsection{分析2回目}
クラスタ1の構成曲の数を調べた所、約400曲含まれていた。そのため、さらに分類ができるのではないかと考え、クラスタ1のみを使い再びクラスタリングを行った。
PCAによる散布図を\figref{fig:cluster1pca}に示す。

黄色で示した部分がサブクラスタ0、青色で示した部分がサブクラスタ1とする。
また、クラスタごとの特徴量平均の比較を\figref{fig:average2}に、クラスタごとのZ-score（平均からの相対距離）を\figref{fig:Z-score2}に示す。



\subsection{分析3回目}
サブクラスタ1を見た所、まだ約300曲含まれていた。さらに分類ができるのではないかと考え、クラスタ1のみを使い再びクラスタリングを行った。
PCAによる散布図を\figref{fig:cluster11pca}に示す。

また、クラスタごとの特徴量平均の比較を\figref{fig:average11}に、クラスタごとのZ-score（平均からの相対距離）を\figref{fig:Z-score11}に示す。

\section{結果と考察}
1回目の分析の結果、\figref{fig:Z-score1}より、クラスタ0がクラスタ1に対して楽曲の長さ、音域の広さ、16分音符の割合、和声進行の規模が大きくなっており、クラスタ0は曲が長く、多数の音域と細かいリズムで複雑な曲が含まれていると推測できる。
一方、クラスタ1は曲が短く、音域が狭く、長い音符が多い単純な曲が含まれていると考えられる。
2回目の分析の結果、\figref{fig:Z-score2}より、サブクラスタ0は半音符の割合が高く、四分音符の割合が低くなっている。曲の長さもサブクラスタ0とサブクラスタ1では相違が見られた。
このことから、サブクラスタ0はリズムがゆったりとした曲が多く含まれていると推測できる。
3回目の分析の結果、\figref{fig:Z-score11}より、サブクラスタ2とサブクラスタ3では大きな相違が見られている。
しかし、\figref{fig:average11}を見た所、dur\_sixteenthの割合が他のクラスタが0に近いのに対し、サブクラスタ2は0.07であり、全体的に数値が小さくなっていることが分かる。
また、\figref{fig:cluster11pca}を見ると、各クラスタに大きな境がなく、クラスタリングがうまくいっていない可能性があると考えられる。このことから、クラスタリングを行い過ぎていると考えられる。
また、サブクラスタ1に含まれている曲がバッハが作成するコラール曲の特徴を多く含んでいるものと推測できる。


\section{各特徴量の相関}
1回目の分析の結果、楽曲の長さがクラスタリングに影響を与えている可能性があると述べた。
そのため、楽曲の長さが各特徴量にどのような影響を及ぼしているのかを相関係数を用いて考えてみる。

\begin{figure}[tb]
  \centering
  \includegraphics[width=0.9\linewidth]{fig/correlation.png}
  \caption{各特徴量の相関係数}
  \label{fig:soukan11}
\end{figure}
\figref{fig:soukan11}に今回研究に使用した全楽曲を対象とした各特徴量の相関係数を示す。
特に0.7以上という強い相関がみられた4例\\
(1)measures $\leftrightarrow$ rn\_seq\_len：r $\approx$ 0.90\\
(2)pitch\_std $\leftrightarrow$ pitch\_range：r $\approx$ 0.89\\
(3)avg\_chord\_size $\leftrightarrow$ seventh\_ratio：r $\approx$ 0.87\\
(4)leap\_rate $\leftrightarrow$ smoothness：r $\approx$ 0.72\\
について考察する。

\subsection{(1)小説数とローマ数字和声進行列長の相関}
(1)
小節数（\texttt{measures}）とローマ数字和声進行列長（\texttt{rn\_seq\_len}）の間に、0.90と強い正の相関が確認された。
これは、楽曲が長くなるほど和声進行の数も増加するという、構造的な依存関係を反映した結果である。
そのため、この二つの特徴量については、楽曲の長さを示す指標として重複していると考えられる。
このことから、特徴量として強い相関がみられる他の3例についても重複がある可能性が考えられたため、その可能性も考えつつ考察を行う。

\subsection{(2)音高の標準偏差と音域の相関}
(2)音高の標準偏差（\texttt{pitch\_std}）と音域（\texttt{pitch\_range}）の間に、0.89と強い正の相関が確認された。
これは、音域が広い楽曲ほど音高の分布も大きくなる傾向を反映している。
この二つについて、全楽曲を対象に平均を取った表が以下の通りである。

\begin{table}[t]
  \centering
  \caption{音高の標準偏差と音域の平均値}
  \label{tab:pitch}
  % \renewcommand{\arraystretch}{1.8} % ← 1.5倍に広げる（1.2〜1.8くらいで調整）
  \begin{tabular}{cc}\hline
    pitch\_std & pitch\_range \\\hline\hline
    3.07       & 12.75        \\\hline
  \end{tabular}
\end{table}

\ref{tab:pitch}より、音域幅は12音半、1オクターブくらいであり、標準偏差が約3半音で、主に中心音付近で旋律が動いている、典型的なコラールであると分かる。
この、12音半というのは音域として狭く、標準偏差も3しかないことから端まで使うことはあるが滞在時間は短いことが分かる。
つまり、バッハのコラールが比較的狭い音域内で均質に旋律が展開されていることから強い相関がみられているように見えるだけで、
音域が狭くても標準偏差が大きいジャンルで実験すれば異なる結果となる可能性があるため、一般的にこの二つの特徴量に強い相関があるとは言えない。
この相関に関しては別ジャンルの楽曲を分析することで、より明確になると考えられる。

\subsection{(3)平均和音サイズと7th和音比率の相関}
(3)平均和音サイズ（\texttt{avg\_chord\_size}）と7th和音比率（\texttt{seventh\_ratio}）の間に、0.87と強い正の相関が確認された。
これは、和音の厚みが増すほど、7thコードの使用頻度も高まる傾向を反映している。
この二つについて、全楽曲を対象に平均を取った表が以下の通りである
\begin{table}[t]
  \centering
  \caption{平均和音サイズと7th和音比率の平均値}
  \label{tab:chord}
  % \renewcommand{\arraystretch}{1.8} % ← 1.5倍に
  \begin{tabular}{cc}\hline
    avg\_chord\_size & seventh\_ratio \\ \hline\hline
    3.22             & 0.29           \\\hline
  \end{tabular}
\end{table}

このことから、バッハのコラールの平均和音は3.22音、7th和音は全和音の約29\%を占めていることが分かる。
バッハのコラールでは三和音が基本構造であり、7th和音の使用は和声的な緊張や進行上の機能として現れるため、7th和音の割合が増加すると平均構成音数も自然に増加すると考えられる。
この二つの特徴量について考えた所、一般的な楽曲では3和音もしくは7th和音が多く使われる。実際に、バッハのコラールではこの２つしか使っていないと仮定すると
\[
  \text{avg\_chord\_size} = 3 \cdot p_3 + 4 \cdot p_4 \quad (p_3 + p_4 = 1)
\]
という式が立てられるはずだと考えた。しかし、p4に7th和音の割合を代入すると
\[
  3 \cdot (1 - 0.29) + 4 \cdot 0.29 = 3.29
\]

となり、\texttt{avg\_chord\_size} = 3.22とは小さい値となるため、バッハのコラールには2つ以下の音がなっている場所も存在していると考えられる。
しかし、今回は2音や1音に関しての割合を調べていないので詳しい話は出来ないのと、
調べたところ、2音や1音は和音ではないという話もあったので、今後の特徴量抽出では2音や1音に関しても調べ、平均和音サイズのコードも見直す必要があると考える。

\subsection{(4)跳躍進行率と滑らかさの相関}
(4)跳躍進行率（\texttt{leap\_rate}）と滑らかさ（\texttt{smoothness}）の間に、0.72と強い正の相関が確認された。
これは、跳躍進行が多いほど、メロディの滑らかかさも増す傾向を反映している。
ここで「滑らかさ」は旋律の移動幅の標準偏差（ムラ）を、 「跳躍進行率」は全音を超える移動の頻度をそれぞれ示している。

一般に、跳躍進行が増えれば旋律の起伏は激しくなり、運動性は向上するが、バッハのコラールにおいてこの二つの指標が強く連動している点は注目に値する。
これは、旋律が飛躍する際、その跳躍の「幅」や「頻度」が無秩序に現れるのではなく、和声的な枠組みの中で極めて統制されたバランス（様式的な一貫性）を持って配置されていることを示唆している。


\section{The MAESTRO Datasetを用いた比較実証}
leap\_rateとsmoothnessの間の相関が高いことが、バッハのコラール特有の現象であるかを確認するため、The MAESTRO Dataset\cite{MAESTRODataset2018}を用いて同様の分析を行った。
MAESTRO Datasetは、主に19世紀のピアノ曲を収録したデータセットであり、今回は20曲を用いた。
プログラムに関しては、4.分析と同様のものを使用する。

\begin{figure}[H]
  \centering
  \includegraphics[width=0.9\linewidth]{fig/corr-maestro.png}
  \caption{MAESTRO Datasetを用いた各特徴量の相関係数}
  \label{fig:soukan22}
\end{figure}

分析を行い、各特徴量の相関係数をまとめたのが図\ref{fig:soukan22}である。バッハにおいて 0.72 であった \texttt{leap\_rate} と \texttt{smoothness} の相関係数は、MAESTRO においては 0.18 という極めて低い値を示した。
この相関の消失は、ロマン派以降の楽曲においては旋律の自由度が増し、和声の密度とは独立した形で装飾的な跳躍や複雑な音型が用いられるようになったことを反映している。
対して、バッハのコラールにおいてのみ高い相関が維持されている事実は、四声体対位法という極めて厳格な制約下において、垂直的な響きと水平的な動きが高度に一体化している「バッハ様式」の構造的特異性を定量的に証明するものである。


\section{まとめ}
本研究では、バッハのコラール曲を特徴量に基づいてクラスタリングし、それぞれのクラスタの特徴を分析した。最初のクラスタリングでは、曲の長さや音域、リズムなどの特徴に基づいて2つのクラスタに分類された。
さらに、クラスタ1を再びクラスタリングすることで、より細かな分類が可能となった。その結果、サブクラスタ1に含まれる曲がバッハが作成するコラール曲の特徴を多く含んでいることが示された。
しかし、過度なクラスタリングにより、クラスタ間の明確な境界が失われる可能性があることも示された。
また、跳躍進行率と滑らかさの強い相関（0.72）を確認し、それが他ジャンルでは見られないバッハ固有の厳格な様式美であることを対照実験によって明らかにした。

\section{今後の課題}
今後の研究では、特徴量の選択やクラスタリング手法の改善を検討し、より精度の高い楽曲分類を目指していく。特に、今回ではできなかった長さを除いた特徴量解析もしていきたい。
その際、特徴量に対しては、楽曲分析を行っている先行研究を参考にし、より音楽的な意味合いを持つ特徴量を多数選択、抽出し、分析に必要な特徴量の取捨選択をすることが重要だと考えている。
また、バッハが作成するコラール曲以外の楽曲も含め同様の分析を行い、比較研究を進めることで、楽曲の特徴や構造に関する理解を深めていきたいと考えている。
研究で用いたThe MAESTRO Datasetの実験は、データ数が多く実行に時間を要したので今回はバッハのコラールの特徴を裏付けるための実験に留めた。今後はデータ数を増やし、より信頼性の高い結果を得られるようにしたい。
橋田准教授より、データセット（PEDB）への運用を提案されたため、今後の研究ではPEDBを用いた分析も検討していく。

\section{参考文献}
\label{sec:refcheck}
\bibliographystyle{muselabunsrt}
\bibliography{subaru} 
\end{document}

\begin{acknowledgment}
  本稿の執筆にあたり，参考文献に挙げた方々のWebサイト，スライド，各種資料を大いに参考にさせていただいた．
\end{acknowledgment}

