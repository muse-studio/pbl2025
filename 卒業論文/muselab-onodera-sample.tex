% !TEX root = _main.tex
% ========================================
% 卒業論文　本文
% ========================================
\section{はじめに}

現代のシンセサイザー等電子楽器を用いた演奏形態(マシンライブやDJ)は、ノブやフェーダー、ボタンを用いた微細かつ連続的なパラメータ制御、ならびに時間的に安定したトリガー入力を可能とする点で高い操作精度を有している。一方で、そのような入力インタフェースでは、演奏行為自体が視覚的には単調に見えやすく、身体動作と音響変化との関係性が直感的に伝わりにくいため、ギターやドラム演奏に比べると、ライブ体験において演奏の印象や没入感が弱く感じる要因となり得る。

筆者は、この身体動作と音響変化の関係性の伝わりにくさは、電子楽器演奏における表現の幅を制限している要因の一つであると考えており、その幅を広げることで、これまでの電子楽器演奏のクールな印象に加えて、新しい印象やイメージ、価値の持ったライブ体験を届けることが可能になると考えた。そして、電子楽器を用いた演奏がもっと視覚的に楽しめるようにするには、これまでの操作に加えて、身体動作と音響変化が一致して伝わる、つまり身体的ジェスチャーを用いた直感的な操作で音を操るといった音響的制御が大切であると考えた。

そこで本研究では、カメラベースのモーションキャプチャ技術であるMediaPipeを用い、演奏者の身体動作を直接MIDI制御へと変換するインタラクティブ演奏システムを提案する。これにより、演奏行動そのものを、視覚的・音響的な表現として捉え直し、電子楽器演奏における没入感の増幅と、既存の枠組みを超えた新たな印象および価値の創出を目指す。




%2
\section{電子楽器の歴史}

\subsection{シンセサイザー}
電子楽器の分野では、テルミンに代表される初期の非接触型楽器に始まり、センサ技術やコンピューターの発展とともに、身体動作を音響制御に用いるインタラクティブ楽器が数多く提案されてきた。特に近年では、加速度センサや深度センサを用いたジェスチャー入力により、演奏者の身体性を音楽表現へ拡張する試みが盛んに行われている。一方で、これらの多くは専用デバイスの装着や特定環境への依存を前提としているほか、演奏操作には一定の習熟が求められることから、ライブパフォーマンスへの導入には依然として制約が存在する。

\subsection{MIDIコントローラー}

\subsection{インタラクティブ楽器}

%3
\section{システム構成}
ユーザーのハンドジェスチャーに対する、電子楽器演奏における没入感の増幅と、既存の枠組みを超えた新たな印象および価値の創出の有効性を検証するため、ハンドジェスチャーによって直感的なMIDI制御が可能なエンタテイメントシステムを構築した。ユーザは片方どちらかの手全体がWebカメラに映る状態を取り、システムに用意されているジェスチャーを行うと、各ジェスチャに対応したMIDI情報がシンセサイザー等のMIDI対応機器に送られ、ユーザーは直感的な操作による演奏を楽しむことができる。

\subsection{MediaPipe}
手指の骨格情報と位置、動きの検出のため、MediaPipeを使用することにした。MediaPipeは、画像や動画データをリアルタイムで処理し、顔認識、姿勢推定、手の検出といった身体動作検出が可能な、Google社が提供するオープンソース機械学習フレームワークである。\figref{fig:MediaPipe_open}は、MediaPipeでの手情報取得の例である。

\begin{figure}[tb]
	\centering
	\includegraphics[width=0.5\hsize]{fig/MediaPipe_open.png}
	\caption{MediaPipeでの手情報取得の例}
	\label{fig:MediaPipe_open}
\end{figure}

本システムでは、Webカメラを使用してユーザーの手を撮影し、得られる手指の関節20箇所の位置情報を映像から取得する。手指の関節20箇所の詳細を\figref{fig:hand-landmarks}に示す。そして、それぞれの箇所の映像中での x座標、y座標を


\begin{figure}[tb]
	\centering
	\includegraphics[width=\hsize]{../fig/hand-landmarks.png}
	\caption{位置情報を取得する20箇所}
	\label{fig:hand-landmarks}
\end{figure}


\subsection{Max}
本システムは、システム構築環境として、ビジュアルプログラミング環境であるMax(Cycling ’74)を用いた。Maxは、音響信号処理や映像処理をリアルタイムに統合して扱うことが可能な開発環境である。ユーザは、それぞれ特定の処理を行うオブジェクトをパッチャ上に配置し、それらを接続することで処理の流れを構築する。今回は、外部入力デバイスから取得した情報を音楽的制御信号へ変換する処理や構造を直感的に設計できることに加え、視覚的に把握することができるといった点から、Maxを使用してシステム構築をすることにした。

\subsection{MIDI}
本システムでは、MIDIを用いて電子楽器を制御する。

MIDIは、シンセサイザー等の電子楽器やコンピュータ間で演奏情報(音の高さ、長さ、強さなど)をやり取りするための共通規格である。MDIで扱うデータ(メッセージ)には、いくつかの種類が存在するが、本システムでは主にノートオン/オフ・ノートナンバー、コントロールチェンジ(CC)の3つのメッセージを扱う。それぞれのメッセージについて詳しく説明する。

\subsubsection{ノートオン/オフ・ノートナンバー}
ノートオンは鍵盤を押したときに送られる音を鳴らす信号、ノートオフは鍵盤を離したときに送られる音を止める信号のことである。また、ノートナンバーは、音の高さを0から127までの数字で表現したものである。これらのメッセージを組み合わせることで、どの高さの音を鳴らす、止めるといった制御が可能になる。

\subsubsection{コントロールチェンジ(CC)}
コントロールチェンジ(以降CCと呼ぶ)は、音量、定位(パン)、音色、モジュレーションなど、音楽的な表現やパラメーターを制御するためのMIDI信号であり、シンセサイザー等のノブやフェーダーの制御量を0〜127の数値として送信し、音色やエフェクトなどをリアルタイムに制御できる。

CCは、どのパラメーターを制御するかを示す0〜127の番号であるコントロールナンバー(CCナンバー)と、そのパラメーターの制御量0〜127の主に２つの要素で構成される。

\section{ハンドジェスチャーによるMIDIの制御}

\subsection{ユーザーが行う動作}
本システムにおいて、ユーザーはハンドサイン、カメラからの距離、手の開き具合、つまみを回す動作といった動作を取ることで、MIDIを操ることができる。

\subsubsection{基本姿勢}

今回はシステムの仕様上、手掌面が撮像デバイスに対して正面を向いている姿勢を基本姿勢とする。ユーザーはこの姿勢からハンドジェスチャーを取ることで、トリガーとしての役割や、MIDI送信値の連続的な変化を、適切に実行することができる。

\subsubsection{ハンドサイン}
本システムでは、Closed Fist、Pointing Up、Victory、ILoveYouの4種類のハンドサイン(\figref{fig:hand-sign})を自動認識し、MIDI情報を送信するトリガーとして使用することができる。

\begin{figure}[tb]
	\centering
	\includegraphics[width=\hsize]{../fig/hand-sign.png}
	\caption{4種類のハンドサイン}
	\label{fig:hand-sign}
\end{figure}


\subsubsection{カメラからの距離}
本システムでは、カメラと手の距離に応じて、\figref{fig:dis_ba}のように連続的に送信値を変化させることができる。

カメラからどれだけ離れているかの測定には、MediaPipeによって得られた手首と小指の付け根の位置座標間の距離を使用している。つまり、距離が短くなる＝カメラから手が離れているとなるわけである。

今回は、それぞれの座標間の距離の中で、カメラからの距離を変えずに様々なハンドジェスチャーを取った際に、距離の変化が少なく、測定箇所が他の指で隠れるようなことも少ないため、この座標間の距離を使用した。また、MediaPipeはz軸座標の取得もできるが、測定誤差が大きいため、本システムでの使用は断念した。

座標間の距離は、手首と小指の付け根それぞれのx軸、y軸座標を、Max内での三平方の定理の計算に用いることで出力している。

\begin{figure}[tb]
	\centering
	\includegraphics[width=\hsize]{../fig/dis_ba.png}
	\caption{カメラからの距離による値の変化}
	\label{fig:dis_ba}
\end{figure}

\subsubsection{手の開き具合}
本システムでは、手の開き具合に応じて、\figref{fig:close_ba}のように連続的に送信値を変化させることができる。

開き具合の測定には、手首と中指先端の位置座標間の距離を使用しており、手首と中指先端それぞれのx軸、y軸座標を、Max内での三平方の定理の計算に用いることで距離を出力している。

また、この出力された値は、単にカメラ画角内の２座標間の距離によるもので、この状態ではカメラと手の距離によっても出力される値は変化してしまう。今回は手の開き具合のみの値を出力したいため、「手首と中指先端間の距離÷カメラからの距離」の計算をすることで、この問題を解決し、ユーザーの手がカメラ画角内のどの位置にいても、出力値が同じ値の幅になるようにした。

\begin{figure}[tb]
	\centering
	\includegraphics[width=\hsize]{../fig/close_ba.png}
	\caption{手の開き具合による値の変化}
	\label{fig:close_ba}
\end{figure}

\subsubsection{つまみを回す動作}
本システムでは、\figref{fig:tsumami_ba}のようにシンセサイザー等についているつまみ・ノブを回すようなジェスチャーをカメラに向けて取ることで、連続的に送信値を変化させることができる。

送信値は、親指先端と人差し指先端の２点間の角度を元に変化する。本システムでは、2点のx座標、y座標それぞれの座標差を使い、アークタンジェント2関数でラジアン値を得て、それを度数に変換することで、角度を出力している。以下はその式である。
\[
\begin{array}{c}
{\displaystyle
\theta_{\mathrm{deg}} =
\arctan\!\left(\frac{f_1}{f_2}\right)\times \frac{180}{\pi}
} \\
{\small
(f_1:\, y\text{座標差},\; f_2:\, x\text{座標差})
}
\end{array}
\]

\begin{figure}[tb]
	\centering
	\includegraphics[width=\hsize]{../fig/tsumami_ba.png}
	\caption{つまみを回す動作による値の変化}
	\label{fig:tsumami_ba}
\end{figure}



%5
\section{システムマニュアル}



\subsection{TRIGGERモードとMOTIONモード}
このシステムには、ハンドサインをトリガーに、指定したMIDI情報を電子楽器等に送信する［TRIGGER］と 、細かな指の動きによる連続的な値の変化によってMIDI CCのコントロールが可能な［MOTION］の２つのモードが存在する。この２つのモードの同時使用はできない。

\subsection{TRIGGER}
［TRIGGER］を押してボタンを点灯または画角内で素早く手を下から上に振ると、TRIGGERモードになる。このモードはハンドジェスチャーの種類で指定したMIDIノートを送信し、カメラからの距離でピッチをコントロールが可能な、モノフォニック・シンセサイザーのように使用することができる。

\subsubsection{基本操作}
トリガーとなるハンドサインを選択し、MIDI送信先の機器、鳴らしたいMIDIノートナンバー、MIDIチャンネルを選択することで、そのハンドサインを取ったと判定した時に、指定した高さの音が鳴る。

\subsubsection{PITCH機能}
この機能をONにすると、かざした手がカメラから遠いほど、スケールにしたがった高い音が出る。スケールとルート音、オクターブ範囲の変更が可能である。

\subsubsection{DISTANCE機能}
この機能をONにすると、かざした手のカメラからの距離で、指定したMIDI CCの値をコントロールすることができる。

最大4種類のMIDI CCを送ることが可能であり、1つのジェスチャーで複数のMIDI CCを送信することもできる。

\subsection{MOTION}
［MOTION］を押してボタンを点灯または画角内で素早く手を上から下に振ると、MOTIONモードになる。このモードは[カメラからの距離][手の開き具合][つまみを回す操作]のいずれかの操作で、MIDI CCをコントロールできる。

\subsection{機能説明}

\subsubsection{スムージング機能}
MediaPipeから得られる連続値を扱う際に、測定誤差や環境要因によって、急激な値変化が起きてしまうことが度々ある。これは、結果的に出力される音の音切れや不自然な音色変化につながってしまうため、どうにか対処する必要があった。そこで、本システムでは、値の時間的変化を平滑化するスムージング機能を導入することで、急激な値変化の抑制と、より自然かつ安定したMIDI制御を実現した。

この機能は、Max内のlineオブジェクトを使用することで成り立っている。今回は、「100msかけて前の値から新しい値へスムーズに変化」とすることで、スムージングを可能にしている。


\subsection{MIDI送信設定}
シンセサイザー等へMIDIを送信するためには、\figref{fig:MIDI-set}のようにMIDI送信先、ノートナンバー・CCナンバー、MIDIチャンネル、MIDI CC範囲の４種類の項目をユーザが設定する必要がある。それぞれの項目について詳しく説明する。

\begin{figure}[tb]
	\centering
	{\setlength{\fboxsep}{0pt}
	 \setlength{\fboxrule}{0.5pt}
	 \fcolorbox{gray}{white}{%
	   \includegraphics[width=0.8\linewidth]{../fig/MIDI-set.png}
	 }}
	\caption{MIDI送信設定画面}
	\label{fig:MIDI-set}
\end{figure}


\subsubsection{MIDI送信先}
この項目では、MIDI情報の送信先を決める。Maxの起動時またはMIDI機器の検索ボタンを押した際に、PCにつながっているシンセサイザー等のMIDI機器がポップアップメニューに表示され、選択したMIDI機器に情報が送信される。

\subsubsection{ノートナンバー・CCナンバー}

\subsubsection{MIDIチャンネル}
MIDI機器によっては、送信先の設定のほかにも、MIDIチャンネルを設定する必要がある。

MIDIチャンネルは、1本のMIDIケーブルで複数の楽器(パート)の演奏情報を区別して送受信するための1〜16の番号で、各パートにチャンネルを割り当てることで、異なる楽器を同時にコントロールすることができる。

本システムでも、1〜16の番号を指定することで、1つのPCで複数のMIDI機器を使い分けることが可能である。

\subsubsection{MIDI CC範囲}
MIDIコントロールチェンジを使ってシンセサイザー等MIDI機器を制御する際に、どの値の範囲のみジェスチャーで変化させるかを設定することができる。

\figref{fig:CC-rangeAB}は設定つまみである。このつまみ両端の白と青の丸を動かすことで範囲を設定することができる。この範囲は\figref{fig:CC-range}のように、MIDIで制御するシンセサイザーのつまみ等のパラメータと模しているものになっており、どの範囲のみパラーメータを変化させるかが視覚的に理解しやすく設定できる。

つまり、カメラからの距離でシンセサイザーを操る場合、\figref{fig:CC-rangeAB}のAの時は、カメラと手の距離が1番短い場合にCC値30を出力し、1番長い場合にCC値100を出力する。

また\figref{fig:CC-rangeAB}のBのように、両端の白と青の丸が逆転している場合は、先ほどと逆方向に値が変化する。つまり、カメラと手の距離が1番短い場合にCC値100を出力し、1番長い場合にCC値30を出力する。

\begin{figure}[tb]
	\centering
	\includegraphics[width=0.8\hsize]{../fig/CC-rangeAB.png}
	\caption{CC範囲設定つまみ}
	\label{fig:CC-rangeAB}
\end{figure}

\begin{figure}[tb]
	\centering
	\includegraphics[width=\hsize]{../fig/CC-range.png}
	\caption{CC範囲設定の詳細}
	\label{fig:CC-range}
\end{figure}

\label{sec:contents}


\section{考察}


\section{おわりに}

